---
interface Props {
  title: string;
  description?: string;
}

const { title, description = 'IELTS Dashboard' } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <title>{title} | My IELTS</title>
  </head>
  <body class="min-h-screen flex bg-white">
    <!-- Sidebar -->
    <aside class="w-[250px] bg-white border-r border-gray-200 fixed h-screen overflow-y-auto">
      <div class="p-6 border-b border-gray-200">
        <h1 class="text-xl font-bold text-black">
          My <span class="text-red-600">IELTS</span>
        </h1>
      </div>

      <nav class="p-4">
        <!-- Main Navigation -->
        <div class="mb-6">
          <a 
            href="/dashboard" 
            class="block px-3 py-2 text-sm text-black hover:bg-gray-50 mb-1"
          >
            Trang chủ
          </a>
          <button class="block px-3 py-2 text-sm text-black hover:bg-gray-50 w-full text-left">
            Tìm kiếm
          </button>
        </div>

        <!-- Tabs as Navigation -->
        <div class="space-y-1 mb-6">
          <a 
            href="/dashboard/grammar" 
            class={`block px-3 py-2 text-sm font-medium text-black ${
              currentPath.startsWith('/dashboard/grammar') 
                ? 'bg-gray-100' 
                : 'hover:bg-gray-50'
            }`}
          >
            Grammar
          </a>
          <a 
            href="/dashboard/vocabulary" 
            class={`block px-3 py-2 text-sm font-medium text-black ${
              currentPath.startsWith('/dashboard/vocabulary') 
                ? 'bg-gray-100' 
                : 'hover:bg-gray-50'
            }`}
          >
            Vocabulary
          </a>
          <a 
            href="/dashboard/expressions" 
            class={`block px-3 py-2 text-sm font-medium text-black ${
              currentPath.startsWith('/dashboard/expressions') 
                ? 'bg-gray-100' 
                : 'hover:bg-gray-50'
            }`}
          >
            Idioms
          </a>
        </div>

        <!-- Boards Section -->
        <div class="border-t border-gray-200 pt-4">
          <div class="flex items-center justify-between px-3 py-2 mb-2">
            <span class="text-xs font-semibold text-gray-500 uppercase">Boards</span>
            <span class="text-xs text-gray-400" id="board-count">0/5</span>
          </div>
          
          <div id="boards-list" class="space-y-1 mb-2">
            <!-- Boards will be rendered here -->
          </div>

          <button 
            id="create-board-btn"
            class="w-full px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 text-left"
          >
            + Tạo bộ từ mới
          </button>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 ml-[250px]">
      <slot />
    </main>

    <!-- Create Board Modal -->
    <div id="create-board-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-bold text-black mb-4">Tạo bộ từ mới</h2>
        
        <form id="create-board-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-black mb-1">Tên bộ từ</label>
            <input 
              type="text" 
              name="name" 
              required
              class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-black"
              placeholder="Ví dụ: IELTS Band 7+"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-black mb-1">Mô tả</label>
            <textarea 
              name="description" 
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-black"
              placeholder="Mô tả ngắn về bộ từ này..."
            ></textarea>
          </div>

          <div class="flex gap-2 justify-end">
            <button 
              type="button" 
              id="cancel-board-btn"
              class="px-4 py-2 text-sm text-gray-600 hover:bg-gray-100"
            >
              Hủy
            </button>
            <button 
              type="submit"
              class="px-4 py-2 text-sm bg-black text-white hover:bg-gray-800"
            >
              Tạo
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

    <script is:inline>
      // Modal handling
      const modal = document.getElementById('create-board-modal');
      const createBtn = document.getElementById('create-board-btn');
      const cancelBtn = document.getElementById('cancel-board-btn');
      const form = document.getElementById('create-board-form');

      createBtn?.addEventListener('click', () => {
        modal?.classList.remove('hidden');
      });

      cancelBtn?.addEventListener('click', () => {
        modal?.classList.add('hidden');
        form?.reset();
      });

      modal?.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.add('hidden');
          form?.reset();
        }
      });

      form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
          name: formData.get('name'),
          description: formData.get('description'),
          type: window.location.pathname.includes('grammar') ? 'grammar' 
              : window.location.pathname.includes('vocabulary') ? 'vocabulary' 
              : 'idioms'
        };

        try {
          const response = await fetch('/api/boards', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          if (response.ok) {
            window.location.reload();
          }
        } catch (error) {
          console.error('Error creating board:', error);
        }
      });
    </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
